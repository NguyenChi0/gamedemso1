<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jump Counting Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style> body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; } </style>
</head>
<body>
<script>
let player;
let rows = 10;
let platforms = [];
let camY = 0;
let worldHeight;
let currentTarget = 1;
let isFalling = false;
let gravity = 0.8;
let jumpSpeed = 12;
let startPlatform;
let treasurePlatform;
let gameWon = false;
let stoneImg, backgroundImg, playerImg, islandImg;
let bgVideo;


function preload() {
  stoneImg = loadImage('stone.png');
  backgroundImg = loadImage('background123.png');
  playerImg = loadImage('nv.png');
  islandImg = loadImage('island.png');
}

function setup() {
  createCanvas(600, 600);

// Load video
  bgVideo = createVideo('songnuoc.mp4');
  bgVideo.hide(); // ·∫®n th·∫ª video HTML
  bgVideo.loop(); // L·∫∑p l·∫°i video
  bgVideo.volume(0); // T·∫Øt ti·∫øng n·∫øu kh√¥ng c·∫ßn

  worldHeight = (rows + 2) * 180; // TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c h√†ng
  generatePlatforms();

  player = {
    x: startPlatform.x + 75, // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ theo platform l·ªõn h∆°n
    y: startPlatform.y - 20, // Gi·∫£m v·ªã tr√≠ nh√¢n v·∫≠t xu·ªëng 20px
    size: 60, // TƒÉng size nh√¢n v·∫≠t t·ª´ 40 l√™n 60
    vy: 0,
    isJumping: false,
    targetX: startPlatform.x + 75,
    targetY: startPlatform.y - 20,
    jumpProgress: 0,
    isAnimating: false
  };
}

function generatePlatforms() {
  platforms = [];
  
  // T·∫°o platform b·∫Øt ƒë·∫ßu (s·ªë 0) - to h∆°n
  startPlatform = {
    x: width / 2 - 75, // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ cho platform l·ªõn h∆°n
    y: worldHeight - 60, // TƒÉng chi·ªÅu cao platform
    label: 0,
    row: -1,
    isStart: true
  };
  
  // T·∫°o c√°c platform cho t·ª´ng h√†ng (1-10)
  for (let i = 0; i < rows; i++) {
    let y = worldHeight - (i + 2) * 160; // TƒÉng kho·∫£ng c√°ch
    let correctAnswer = i + 1;
    
    // T·∫°o 3 platform nh∆∞ng ch·ªâ 1 ƒë√∫ng
    let row = [];
    let wrongAnswers = [];
    
    // T·∫°o 2 ƒë√°p √°n sai
    while (wrongAnswers.length < 2) {
      let wrong = floor(random(1, 21));
      if (wrong !== correctAnswer && !wrongAnswers.includes(wrong)) {
        wrongAnswers.push(wrong);
      }
    }
    
    // Tr·ªôn ƒë√°p √°n v√† ƒë·∫∑t v√†o 3 v·ªã tr√≠
    let answers = [correctAnswer, ...wrongAnswers];
    answers = shuffle(answers);
    
    for (let j = 0; j < 3; j++) {
      let x = 75 + j * 180; // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ cho platform l·ªõn h∆°n
      row.push({ 
        x, 
        y, 
        label: answers[j], 
        row: i,
        isCorrect: answers[j] === correctAnswer
      });
    }
    platforms.push(row);
  }
  
  // T·∫°o platform kho b√°u (s·ªë 11) - to h∆°n
  treasurePlatform = {
    x: width / 2 - 65,
    y: worldHeight - (rows + 2) * 160,
    label: 11,
    row: rows,
    isTreasure: true
  };
}

function draw() {
  // V·∫Ω background
  if (bgVideo) {
  image(bgVideo, 0, 0, width, height); // V·∫Ω video l√†m n·ªÅn
} else {
  background(135, 206, 235);
}

  
  updateCamera();

  push();
  translate(0, camY);

  // V·∫Ω platform b·∫Øt ƒë·∫ßu
  drawPlatform(startPlatform);
  
  // V·∫Ω c√°c platform game
  for (let row of platforms) {
    for (let p of row) {
      // Ch·ªâ v·∫Ω platform n·∫øu kh√¥ng b·ªã ·∫©n
      if (!p.isHidden) {
        drawPlatform(p);
      }
    }
  }
  
  // V·∫Ω kho b√°u
  drawTreasure(treasurePlatform);

  // C·∫≠p nh·∫≠t animation nh√¢n v·∫≠t
  updatePlayer();

  // V·∫Ω nh√¢n v·∫≠t
  if (playerImg) {
    tint(isFalling ? color(255, 100, 100) : color(255, 255, 255));
    image(playerImg, player.x - player.size/2, player.y - player.size/2, player.size, player.size);
    noTint();
  } else {
    // Fallback n·∫øu kh√¥ng load ƒë∆∞·ª£c ·∫£nh
    fill(isFalling ? color(255, 100, 100) : color(100, 255, 100));
    stroke(50);
    strokeWeight(2);
    ellipse(player.x, player.y, player.size);
  }

  pop();

  applyGravity();
}

function drawPlatform(p) {
  if (stoneImg) {
    image(stoneImg, p.x, p.y, 150, 70); // TƒÉng size platform t·ª´ 100x30 l√™n 150x40
  } else {
    // Fallback n·∫øu kh√¥ng load ƒë∆∞·ª£c ·∫£nh
    if (p.isStart) {
      fill(139, 69, 19); // Brown for start
      stroke(101, 67, 33);
    } else {
      fill(150, 150, 150); // Gray
    }
    strokeWeight(2);
    rect(p.x, p.y, 150, 40, 8); // TƒÉng size platform
  }
  
  // V·∫Ω s·ªë
  fill(255);
  stroke(0);
  strokeWeight(1);
  textAlign(CENTER, CENTER);
  textSize(24); // TƒÉng size text t·ª´ 20 l√™n 24
  textStyle(BOLD);
  text(p.label, p.x + 75, p.y + 20); // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ text
}

function drawTreasure(p) {
  // V·∫Ω kho b√°u b·∫±ng h√¨nh ·∫£nh island.png
  if (islandImg) {
    image(islandImg, p.x-35, p.y-40, 250, 100); // S·ª≠ d·ª•ng h√¨nh ·∫£nh island.png
  } else {
    // Fallback n·∫øu kh√¥ng load ƒë∆∞·ª£c ·∫£nh island.png
    fill(255, 215, 0); // Gold
    stroke(218, 165, 32);
    strokeWeight(4);
    rect(p.x, p.y, 250, 100, 20); // TƒÉng size
  }
  
  // V·∫Ω bi·ªÉu t∆∞·ª£ng kho b√°u
  fill(255, 140, 0);
  stroke(0);
  strokeWeight(1);
  textAlign(CENTER, CENTER);
  textSize(28); // TƒÉng size icon
  text("üíé", p.x + 75, p.y + 10); // ƒêi·ªÅu ch·ªânh v·ªã tr√≠
}

function updatePlayer() {
  if (player.isAnimating) {
    player.jumpProgress += 0.02; // Gi·∫£m t·ªëc ƒë·ªô animation t·ª´ 0.08 xu·ªëng 0.04
    
    if (player.jumpProgress >= 1) {
      player.jumpProgress = 1;
      player.isAnimating = false;
      player.isJumping = false;
    }
    
    // Smooth interpolation v·ªõi easing
    let t = easeInOutQuad(player.jumpProgress);
    player.x = lerp(player.x, player.targetX, t * 0.15); // Gi·∫£m t·ªëc ƒë·ªô di chuy·ªÉn t·ª´ 0.3 xu·ªëng 0.15
    player.y = lerp(player.y, player.targetY, t * 0.15);
  }
}

function easeInOutQuad(t) {
  return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
}

function drawUI() {
  // Background cho UI
  fill(0, 0, 0, 100);
  rect(0, 0, width, 60);
  
  // Hi·ªÉn th·ªã ƒëi·ªÉm
  fill(255);
  textAlign(CENTER, CENTER);
  textSize(18);
  text(`ƒêi·ªÉm: ${currentTarget - 1}/10`, width / 2, 30);
}

function updateCamera() {
  let targetCamY = -player.y + height / 2;
  targetCamY = constrain(targetCamY, -worldHeight + height, 0);
  camY = lerp(camY, targetCamY, 0.1);
}

function applyGravity() {
  if ((player.isJumping || isFalling) && !player.isAnimating) {
    player.vy += gravity;
    player.y += player.vy;
  }

  // R∆°i xu·ªëng ƒë√°y
  if (player.y > worldHeight + 200) {
    noLoop();
    // Game over - kh√¥ng c√≥ alert
  }
}

function mousePressed() {
  if (player.isJumping || isFalling || gameWon || player.isAnimating) return;

  let mouseYWorld = mouseY - camY;
  let mouseXWorld = mouseX;

  // Ki·ªÉm tra click v√†o platform th∆∞·ªùng
  for (let row of platforms) {
    for (let p of row) {
      if (!p.isHidden && isClickInPlatform(mouseXWorld, mouseYWorld, p)) {
        if (p.label === currentTarget) {
          jumpTo(p);
          // X√≥a c√°c ƒë√°p √°n sai trong h√†ng n√†y
          hideWrongAnswers(p.row);
          currentTarget++;
          if (currentTarget > rows) {
            // K√≠ch ho·∫°t kho b√°u - kh√¥ng c√≥ alert
          }
        } else {
          fallDown();
        }
        return;
      }
    }
  }
  
  // Ki·ªÉm tra click v√†o kho b√°u
  if (currentTarget > rows && isClickInPlatform(mouseXWorld, mouseYWorld, treasurePlatform)) {
    jumpTo(treasurePlatform);
    setTimeout(() => {
      gameWon = true;
      noLoop();
      alert("üèÜ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh game v√† t√¨m ƒë∆∞·ª£c kho b√°u!");
    }, 1000);
  }
}

function isClickInPlatform(mouseX, mouseY, platform) {
  return mouseX >= platform.x && 
         mouseX <= platform.x + 150 && // ƒêi·ªÅu ch·ªânh cho platform l·ªõn h∆°n
         mouseY >= platform.y && 
         mouseY <= platform.y + 40; // ƒêi·ªÅu ch·ªânh cho platform cao h∆°n
}

function jumpTo(platform) {
  player.isJumping = true;
  player.isAnimating = true;
  player.jumpProgress = 0;
  player.targetY = platform.y - 10; // Gi·∫£m v·ªã tr√≠ nh√¢n v·∫≠t xu·ªëng 20px
  player.targetX = platform.x + 75; // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ cho platform l·ªõn h∆°n
}

function fallDown() {
  isFalling = true;
  player.vy = 5;
}

function hideWrongAnswers(rowIndex) {
  // ·∫®n t·∫•t c·∫£ c√°c ƒë√°p √°n sai trong h√†ng n√†y
  for (let p of platforms[rowIndex]) {
    if (!p.isCorrect) {
      p.isHidden = true;
    }
  }
}

function keyPressed() {
  if (key === 'r' || key === 'R') {
    // Reset game
    currentTarget = 1;
    isFalling = false;
    gameWon = false;
    generatePlatforms();
    player.x = startPlatform.x + 75;
    player.y = startPlatform.y - 20;
    player.vy = 0;
    player.isJumping = false;
    player.isAnimating = false;
    player.jumpProgress = 0;
    loop();
  }
}
</script>
</body>
</html>